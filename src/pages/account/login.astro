---
import Layout from "../../layouts/Layout.astro";

// Welcome to Astro! Wondering what to do next? Check out the Astro documentation at https://docs.astro.build
// Don't want to use any of this? Delete everything in this file, the `assets`, `components`, and `layouts` directories, and start fresh.
---
<script type="text/javascript">
  function logIn() {
    var accountData = new FormData();
    var username = document.getElementById("username").value
    accountData.append("username", username);
    accountData.append("password", document.getElementById("password").value);

    var xhr = new XMLHttpRequest();
    xhr.open("POST", "http://127.0.0.1:5000/account/login");

    xhr.onload = () => {
      if (xhr.status == 200) {
        var date = new Date();
        date.setTime(date.getTime() + 30*24*60*60*1000); // Cookie expires in 30 days
        document.cookie = `username=${username}; expires=${date.toUTCString()}; path=/`
        window.location.replace("/");
      }
      else {
        document.getElementById("status").innerHTML = "Username or password is incorrect.";
      }
    };

    xhr.send(accountData);
    
    return false;
  }
</script>

<Layout>
  <div class="container">
    <form id="form" onsubmit="return logIn()">
      <label class="title">Log In</label><br>
      <br>
      <label for="username">Username:</label><br>
      <input class="item" type="text" id="username" name="username" placeholder="deadbeef" required><br>

      <label for="password">Password: </label><br>
      <input class="item" type="password" id="password" name="password" required><br>

      <input class="item" type="submit" id="submit" value="Log In">
    </form>
    <br>
    <a href="/account/create">Create an Account</a>
    <p id="status"></p>
  </div>
</Layout>

<style>
  .container {
    width: 80%;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    margin: auto;
  }
  #form {
    width: 30%;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;

    margin: auto;
  }
  .title {
    font-weight: 700;
    font-size: 30px;
  }
  #username,
  #password {
    width: 100%;
    height: 2em;
    padding: 1% 2%;
  }
  #submit {
    background-color: #fff;
    padding: 1% 2%;
  }
  #submit:hover {
    cursor: pointer;
  }

  a {
    font-size: 13px;
    margin: auto;
  }

  #status {
    font-size: 13px;
    color: red;
  }
</style>

